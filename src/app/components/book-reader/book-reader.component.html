<div class="min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col">
    <!-- Loading State -->
    <div *ngIf="loading" class="flex-1 flex items-center justify-center">
        <div class="text-xl text-gray-600 dark:text-gray-400">Loading book...</div>
    </div>

    <!-- Error State -->
    <div
        *ngIf="error && !loading"
        class="flex-1 flex items-center justify-center"
    >
        <div class="text-xl text-red-600 dark:text-red-400">{{ error }}</div>
    </div>

    <!-- Book Reader -->
    <div *ngIf="book && !loading && !error" class="flex-1 flex flex-col">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm p-4">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <button
                    (click)="backToLibrary()"
                    class="px-3 py-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-md transition"
                >
                    ← Back to Library
                </button>
                <div class="flex-1 text-center">
                    <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100">
                        {{ book.title }}
                    </h1>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        {{ book.targetLanguage }} → {{ book.nativeLanguage }}
                    </p>
                </div>
                <div class="w-32"></div>
                <!-- Spacer for centering -->
            </div>
        </header>

        <!-- Page Content -->
        <main class="flex-1 overflow-y-auto p-8">
            <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-md p-8">
                <div class="mb-6 text-center text-sm text-gray-500 dark:text-gray-400">
                    Page {{ currentPageIndex + 1 }} of {{ totalPages }}
                </div>

                <!-- Sentences -->
                <div class="space-y-6">
                    <div
                        *ngFor="
                            let sentence of currentPage?.sentences;
                            let i = index
                        "
                        class="relative"
                    >
                        <!-- Target Language (always visible) -->
                        <p
                            class="text-lg leading-relaxed"
                            [class.text-gray-800]="!isDarkMode"
                            [class.dark:text-gray-200]="isDarkMode"
                            [class.opacity-0]="shouldShowNative(i)"
                        >
                            {{ sentence.target }}
                        </p>

                        <!-- Native Language (overlay with inverted color mode) -->
                        <p
                            *ngIf="shouldShowNative(i)"
                            class="absolute top-0 left-0 text-lg leading-relaxed font-medium"
                            [class.text-gray-200]="!isDarkMode"
                            [class.bg-gray-800]="!isDarkMode"
                            [class.text-gray-800]="isDarkMode"
                            [class.bg-gray-100]="isDarkMode"
                            [class.px-1]="true"
                            [class.rounded]="true"
                        >
                            {{ sentence.native }}
                        </p>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between items-center mt-8">
                    <button
                        (click)="previousPage()"
                        [disabled]="currentPageIndex === 0"
                        class="px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition"
                    >
                        ← Previous
                    </button>
                    <button
                        (click)="nextPage()"
                        [disabled]="currentPageIndex === totalPages - 1"
                        class="px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition"
                    >
                        Next →
                    </button>
                </div>
            </div>
        </main>

        <!-- Bottom Slider -->
        <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-4 shadow-lg">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-2">
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
                            Translation Level: {{ sliderValue }}%
                            <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">
                                (Use ↑↓ arrow keys to adjust by 5, ←→ to change
                                pages)
                            </span>
                        </span>
                    </label>
                    <button
                        (click)="toggleMaintainTranslationLevel()"
                        class="px-3 py-1 text-xs rounded-md border transition"
                        [class.bg-blue-600]="maintainTranslationLevel"
                        [class.dark:bg-blue-500]="maintainTranslationLevel"
                        [class.text-white]="maintainTranslationLevel"
                        [class.border-blue-600]="maintainTranslationLevel"
                        [class.dark:border-blue-500]="maintainTranslationLevel"
                        [class.bg-white]="!maintainTranslationLevel"
                        [class.dark:bg-gray-700]="!maintainTranslationLevel"
                        [class.text-gray-700]="!maintainTranslationLevel"
                        [class.dark:text-gray-300]="!maintainTranslationLevel"
                        [class.border-gray-300]="!maintainTranslationLevel"
                        [class.dark:border-gray-600]="!maintainTranslationLevel"
                        [class.hover:bg-blue-700]="maintainTranslationLevel"
                        [class.dark:hover:bg-blue-600]="maintainTranslationLevel"
                        [class.hover:bg-gray-50]="!maintainTranslationLevel"
                        [class.dark:hover:bg-gray-600]="!maintainTranslationLevel"
                        title="When enabled, translation level persists across pages. When disabled, it resets to 0% on each page change."
                    >
                        {{ maintainTranslationLevel ? '✓' : '' }} Maintain Level
                    </button>
                </div>
                <input
                    type="range"
                    min="0"
                    max="100"
                    step="1"
                    [(ngModel)]="sliderValue"
                    (input)="onSliderChange()"
                    class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600 dark:accent-blue-500"
                />
                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                    <span>Native ({{ book.nativeLanguage }})</span>
                    <span>Target ({{ book.targetLanguage }})</span>
                </div>
            </div>
        </footer>
    </div>
</div>
