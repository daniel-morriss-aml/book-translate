<div
    class="h-screen bg-gray-100 dark:bg-gray-900 flex flex-col"
    (swipeleft)="nextPage()"
    (swiperight)="previousPage()"
>
    <!-- Loading State -->
    @if (loading) {
    <div class="flex-1 flex items-center justify-center">
        <div class="text-xl text-gray-600 dark:text-gray-400">
            Loading book...
        </div>
    </div>
    }

    <!-- Error State -->
    @if (error && !loading) {
    <div class="flex-1 flex items-center justify-center">
        <div class="text-xl text-red-600 dark:text-red-400">{{ error }}</div>
    </div>
    }

    <!-- Book Reader -->
    @if (book && !loading && !error) {
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <app-header
            [book]="book"
            [isChapterContext]="isChapterContext"
            [parentBookId]="parentBookId"
        ></app-header>

        <!-- Progress Indicator -->
        @if (settings().showProgressIndicator) {
        <app-progress-indicator
            [currentPage]="currentPageIndex"
            [totalPages]="totalPages"
        ></app-progress-indicator>
        }

        <!-- Page Content -->
        <main class="flex-1 overflow-y-auto lg:pt-8" #pageContent>
            <div
                class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-md p-8"
            >
                <div
                    class="mb-6 text-center text-sm text-gray-500 dark:text-gray-400"
                >
                    Page {{ currentPageIndex + 1 }} of {{ totalPages }}
                </div>

                <!-- Sentences -->
                <div class="space-y-4">
                    @for (sentence of currentPage?.sentences; track
                    sentence.target; let i = $index) {
                    <div class="transition-all duration-300 ease-in-out">
                        <!-- Target Language (always visible) -->
                        <p
                            class="text-lg leading-relaxed text-gray-800 dark:text-gray-200"
                        >
                            {{ sentence.target }}
                        </p>

                        <!-- Native Language (shows below when slider engaged) -->
                        @if (shouldShowNative(i)) {
                        <p
                            class="text-base leading-relaxed text-gray-600 dark:text-gray-400 mt-2 italic"
                        >
                            {{ sentence.native }}
                        </p>
                        }
                    </div>
                    }
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between items-center mt-8">
                    <button
                        (click)="previousPage()"
                        [disabled]="currentPageIndex === 0"
                        class="px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition"
                    >
                        ← Previous
                    </button>

                    <!-- Reset Progress Button (only show when on a page before furthest read) -->
                    @if (furthestReadPage !== null && currentPageIndex <
                    furthestReadPage) {
                    <button
                        (click)="openSetProgressModal()"
                        class="px-4 py-2 bg-orange-600 dark:bg-orange-500 text-white rounded-md hover:bg-orange-700 dark:hover:bg-orange-600 transition"
                    >
                        Reset Progress
                    </button>
                    }

                    <!-- Next or Next Chapter Button -->
                    @if (isLastPage() && isChapterContext && nextChapterId) {
                    <button
                        (click)="goToNextChapter()"
                        class="px-4 py-2 bg-purple-600 dark:bg-purple-500 text-white rounded-md hover:bg-purple-700 dark:hover:bg-purple-600 transition"
                    >
                        Next Chapter →
                    </button>
                    } @else {
                    <button
                        (click)="nextPage()"
                        [disabled]="currentPageIndex === totalPages - 1"
                        class="px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition"
                    >
                        Next →
                    </button>
                    }
                </div>
            </div>
        </main>

        <!-- Bottom Slider - Now Sticky -->
        @if (settings().showTranslationSlider) {
        <app-slider
            [sliderValue]="sliderValue"
            [maintainTranslationLevel]="maintainTranslationLevel"
            [book]="book"
            (sliderChange)="onSliderChange($event)"
            (maintainLevelToggle)="toggleMaintainTranslationLevel()"
        ></app-slider>
        }
    </div>

    <!-- Set Progress Modal -->
    @if (showSetProgressModal) {
    <div
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
        <div
            class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl"
        >
            @if (furthestReadPage !== null && currentPageIndex <
            furthestReadPage) {
            <p class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4">
                Reset Progress
            </p>
            <p class="text-gray-600 dark:text-gray-400 mb-6">
                Reset your progress to page {{ currentPageIndex + 1 }} of
                {{ totalPages }}? This will mark this page as your furthest read
                page.
            </p>
            }
            <div class="flex justify-end space-x-3">
                <button
                    (click)="closeSetProgressModal()"
                    class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-400 dark:hover:bg-gray-700 transition"
                >
                    Cancel
                </button>
                <button
                    (click)="confirmSetProgress()"
                    class="px-4 py-2 bg-green-600 dark:bg-green-500 text-white rounded-md hover:bg-green-700 dark:hover:bg-green-600 transition"
                >
                    Confirm
                </button>
            </div>
        </div>
    </div>
    } }
</div>
